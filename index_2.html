<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.2.js"
            integrity="sha256-4/zUCqiq0kqxhZIyp4G0Gk+AOtCJsY1TA00k5ClsZYE=" crossorigin="anonymous"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
          integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"
          integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
            integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
            crossorigin="anonymous"></script>

    <link rel="stylesheet" href="estilos.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.js"></script>
    <script src="nv.d3.js"></script>
    <link rel="stylesheet" href="nv.d3.css">

    <!--<script src="http://www.d3plus.org/js/d3plus.js"></script>!-->


    <title>Title of the document</title>

</head>

<body>
<div class="container">
    <div class="row">
        <div class="col-md-3 col-xs-12 col-sm-2" id="personal-info">
            <h1>
                Hi! I'm Ivania Donoso
            </h1>
            <h4>
                + blabla con descripci√≥n
            </h4>
            <div class="row">
                <div class="col-md-12 col-xs-12 col-sm-12">
                    <ul class="nav nav-pills nav-stacked">
                        <li role="presentation"><a href="#education">Education</a></li>
                        <li role="presentation"><a href="#work">Working Experience</a></li>
                        <li role="presentation"><a href="#research">Research and Teaching Experience</a></li>
                        <li role="presentation"><a href="#skills">Skills</a></li>
                        <li role="presentation"><a href="#languages">Languages</a></li>
                        <li role="presentation"><a href="#interests">Other Interests</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="col-md-9 col-xs-12 col-sm-10" id="info">
            <div class="row" id="education">
                <div class="col-md-12 col-xs-12 col-sm-12">
                    <h2>Education</h2>

                </div>
            </div>
            <div class="row" id="working_experience">
                <div class="col-md-12 col-xs-12 col-sm-12">
                    <h2>Working Experience</h2>

                </div>
            </div>
            <div class="row" id="research_experience">
                <div class="col-md-12 col-xs-12 col-sm-12">
                    <h2>Research and Teaching Experience</h2>

                </div>
            </div>
            <div class="row" id="skills">
                <div class="col-md-12 col-xs-12 col-sm-12">
                    <h2>Technical Skills</h2>

                </div>
            </div>
            <div class="row" id="oskills">
                <div class="col-md-12 col-xs-12 col-sm-12">
                    <h2>Other Skills</h2>

<div id="viz"></div>
                </div>
            </div>
            <div class="row" id="interests">
                <div class="col-md-12 col-xs-12 col-sm-12">
                    <h2>Other Interests</h2>

                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    function loadDatesCity(dates_, city_) {
        var left = document.createElement("div");
        left.setAttribute('class', 'col-md-2');

        var dates = document.createElement("p");
        dates.appendChild(document.createTextNode(dates_))
        dates.setAttribute('class', 'dates')
        var city = document.createElement("p");
        city.setAttribute('class', 'city')
        city.appendChild(document.createTextNode(city_))

        left.appendChild(dates)
        left.appendChild(city)
        return left
    }
    function loadExperience(div, contentInfo, _type) {
        for (var i = 0; i < contentInfo.length; i++) {

            var row = document.createElement("div");
            row.setAttribute('class', 'row');
            div.appendChild(row)

            // Fecha y ciudad
            var left = loadDatesCity(contentInfo[i]['dates'], contentInfo[i]['city'])
            var right = document.createElement("div");
            right.setAttribute('class', 'col-md-10');
            if (_type) {
                // Contenido
                var what = document.createElement("h3");
                what.setAttribute('class', 'what')
                what.appendChild(document.createTextNode(contentInfo[i]['what']))
                var where = document.createElement("h4");
                where.appendChild(document.createTextNode(contentInfo[i]['where']))
                var extra = document.createElement("p");
                extra.appendChild(document.createTextNode(contentInfo[i]['relevant_classes']))
                right.appendChild(what)
                right.appendChild(where)
                right.appendChild(extra)
            } else {
                var what = document.createElement("h3");
                what.setAttribute('class', 'what')
                what.appendChild(document.createTextNode(contentInfo[i]['what']))
                var where = document.createElement("h4");
                where.appendChild(document.createTextNode(contentInfo[i]['where']))
                var extra = document.createElement("p");
                extra.appendChild(document.createTextNode(contentInfo[i]['activities']))
                right.appendChild(what)
                right.appendChild(where)
                right.appendChild(extra)
                if (contentInfo[i]['bullet_points'].length > 0) {
                    var bullet = document.createElement("ul")
                    for (var j = 0; j < contentInfo[i]['bullet_points'].length; j++) {
                        var li = document.createElement("li")
                        li.appendChild(document.createTextNode(contentInfo[i]['bullet_points'][j]))
                    }
                    right.appendChild(bullet)
                }


            }

            row.appendChild(left)
            row.appendChild(right)

        }
    }
    function loadSkills(div, contentInfo, key) {
        var row = document.createElement("div");
        row.setAttribute('class', 'row');

        div.appendChild(row)
        var right = document.createElement("div");
        right.setAttribute('class', 'col-md-12');
        row.appendChild(right)
        for (section in contentInfo) {
            if (section == "Programming Languages") {
                var h3 = document.createElement("h3")
                h3.appendChild(document.createTextNode(section))

                var divChart = document.createElement("div")
                divChart.setAttribute("id", "chart" + section[0])
                var chart = document.createElement("svg")
                divChart.appendChild(chart)
                right.appendChild(h3)
                right.appendChild(divChart)

                var aux = [
                        {
                            key: 'Series1',
                            color: '#d62728',
                            values:  contentInfo[section]
                        }
                    ]
                console.log(aux)
                nv.addGraph(function() {
                    chart = nv.models.multiBarHorizontalChart()
                        .x(function(d) { return d.name })
                        .y(function(d) { return d.expertise })
                        .yErr(function(d) { return [-Math.abs(d.value * Math.random() * 0.3), Math.abs(d.value * Math.random() * 0.3)] })
                        .barColor(d3.scale.category20().range())
                        .duration(250)
                        .stacked(true);

                    console.log(chart)

                    chart.yAxis.tickFormat(d3.format(',.2f'));

                    d3.select("#chart" + section[0] + " svg")
                        .datum(aux)
                        .call(chart);

                    nv.utils.windowResize(chart.update);

                    chart.dispatch.on('stateChange', function(e) { nv.log('New State:', JSON.stringify(e)); });
                    chart.state.dispatch.on('change', function(state){
                        nv.log('state', JSON.stringify(state));
                    });
                    return chart;
                });



            }
        }
    }
     var chart;
$.getJSON("cv_info.json", function(info) {

    for (var key in info) {
        var _type = key == "education" ? true : false
        var div = document.getElementById(key).children[0]
        var contentInfo = info[key]
        if (_type){
            loadExperience(div, contentInfo, _type)
        }
        if (key == "skills"){
            loadSkills(div, contentInfo, key)
        }
        //console.log(contentInfo)
    }

});


</script>
</html>

